{% extends base_layout %}

{% block header_title %}
    {% trans %}Trip{% endtrans %}
{% endblock %}



{% block content %}

	<div id="panel">
      <input id="target" type="text" placeholder="Location">
    </div>
    <div style="height:500px; width:600px; margin: 0; padding: 0;" id="map-canvas"></div>
    
    
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
    <script>
		function initialize() {
  			var map = new google.maps.Map(document.getElementById('map-canvas'), {
    			mapTypeId: google.maps.MapTypeId.ROADMAP
  			});
  			var defaultBounds = new google.maps.LatLngBounds(
      			new google.maps.LatLng(-33.8902, 151.1759),
      			new google.maps.LatLng(-33.8474, 151.2631));
  			map.fitBounds(defaultBounds);

  			var input = /** @type {HTMLInputElement} */(document.getElementById('target'));
  			console.log(input);
  			var searchBox = new google.maps.places.SearchBox(input);
  			var markers = [];

  			google.maps.event.addListener(searchBox, 'places_changed', function() {
    		var places = searchBox.getPlaces();

    		for (var i = 0, marker; marker = markers[i]; i++) {
      			marker.setMap(null);
    		}

    		markers = [];
    		var bounds = new google.maps.LatLngBounds();
    		for (var i = 0, place; place = places[i]; i++) {
      			var image = {
        			url: place.icon,
        			size: new google.maps.Size(71, 71),
        			origin: new google.maps.Point(0, 0),
        			anchor: new google.maps.Point(17, 34),
        			scaledSize: new google.maps.Size(25, 25)
      			};

      			var marker = new google.maps.Marker({
        			map: map,
        			icon: image,
        			title: place.name,
        			position: place.geometry.location
      			});
      			
      			var infowindow = new google.maps.InfoWindow({
      				content: "Button"
  				});
      			
      			google.maps.event.addListener(marker, 'click', function() {
    				infowindow.open(map,marker);
  				});

      			markers.push(marker);

      			bounds.extend(place.geometry.location);
    		}

    		map.fitBounds(bounds);
  		});

  		google.maps.event.addListener(map, 'bounds_changed', function() {
    		var bounds = map.getBounds();
    		searchBox.setBounds(bounds);
  		});
  		
	
	
	var clickMarker;
	
	function placeMarker(location) {
  		if (clickMarker) {
    		clickMarker.setPosition(location);
  		} else {
    		clickMarker = new google.maps.Marker({
      			position: location,
      			map: map
    		});
  		}
	}
	google.maps.event.addListener(map, 'click', function(event) {
  		placeMarker(event.latLng);
	});
	}


	google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    
{% endblock %}